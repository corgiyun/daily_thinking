# 发布-订阅模式

### 前言
发布-订阅模式又叫观察者模式，它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。在JavaScript开发中，我们一般用事件模型来替代传统的发布-订阅模式。

### 发布-订阅者的作用
1. 发布-订阅模式可以广泛应用于异步编程中，这是一种替代传递回调函数的方案。如果我们订阅ajax请求的error、succ等事件。或者如果想在动画的每一帧完成之后做一些事情，那我们可以订阅一个事件，然后在动画的每一帧完成之后发布这个事件。在异步编程中使用发布-订阅者模式，我们就无须过多关注对象在异步运行期间的内部状态，而只需要订阅感兴趣的事件发生点。

2. 发布-订阅模式可以取代对象之间硬编码的通知机制，一个对象不用再显式地调用另外一个对象的某个接口。发布-订阅模式让两个对象耦合地联系在一起，虽然不太清楚彼此的细节，但这不影响它们之间相互通信。当有新的订阅者出现时，发布者的代码不需要任何修改；同样发布者需要改变时，也不会影响到之前的订阅者。只要之前约定的事件名没有变化，就可以自由地改变它们。

### DOM事件
实际上，只要我们曾经在DOM节点上面绑定过事件函数，那我们就曾经使用过发布-订阅模式
```js
document.body.addEventListener('click', function() {
    alert(1)
}, false);

document.body.click(); // 模拟用户点击
```
在这里需要监控用户点击document.body的动作，但是我们没办法预知用户将在什么时候点击。所以我们订阅document.body上的click事件，当body被点击时，body节点便会向订阅者发布这个消息。
当然我们可以随意增加或者删除订阅者，增加任何订阅者都不会影响发布者代码的编写：
```js
document.body.addEventListener('click', function() {
    alert(2)
}, false);

document.body.addEventListener('click', function() {
    alert(3)
}, false);

document.body.addEventListener('click', function() {
    alert(4)
}, false);

documemt.body.click(); // 模拟用户点击